from simple_term_menu import TerminalMenu
from pentest_cl import starting_menu

##############################################
# 
# Target menu stuff
#
##############################################
def add_ips_to_file():
    target_ips = input("Enter the list of IP addresses (including subnets), separated by commas: ")
    ips_list = target_ips.split(",")
    with open("target_ips.txt", "a") as f:
        for ip in ips_list:
            f.write(ip.strip() + "\n")

def open_and_append_file():
    file_path = input("Enter the path of the file to open: ")
    try:
        with open(file_path, "r") as f:
            ips = f.readlines()
            with open("target_ips.txt", "a") as target_file:
                for ip in ips:
                    target_file.write(ip.strip() + "\n")
        print("IPs added to target_ips.txt")
    except FileNotFoundError:
        print("File not found.")
    

def remove_single_target():
    with open("target_ips.txt", "r") as f:
        targets = f.readlines()
        print("Current targets:")
        for i, target in enumerate(targets):
            print(f"{i + 1}. {target.strip()}")
        target_to_remove = input("Enter the number of the target to remove: ")
        try:
            target_to_remove = int(target_to_remove)
            if 1 <= target_to_remove <= len(targets):
                del targets[target_to_remove - 1]
                with open("target_ips.txt", "w") as f:
                    f.writelines(targets)
                print("Target removed successfully.")
            else:
                print("Invalid target number.")
        except ValueError:
            print("Invalid input. Please enter a number.")

def remove_all_targets():
    try:
        open("target_ips.txt", "r")
        confirmation = input("Are you sure you want to remove all targets? (yes/no): ")
        if confirmation.lower() == "yes":
            open("target_ips.txt", "w").close()
            print("All targets removed successfully.")
        elif confirmation.lower() == "no":
            print("No targets were removed.")
        else:
            print("Invalid choice.")
    except FileNotFoundError:
        print("No targets file exists.")

def remove_targets():
    remove_options = ["Remove single target", "Remove target file"]
    remove_terminal_menu = TerminalMenu(remove_options)
    remove_entry_index = remove_terminal_menu.show()
    print(f"You have selected {remove_options[remove_entry_index]}!")

    match remove_options[remove_entry_index]:
        case "Remove single target":
            print("Single Target")
            remove_single_target()
        case "Remove target file":
            print("All targets")
            remove_all_targets()
            


def targets():
    options = ["List targets", "Add IPs", "Open file of IPs", "Remove target(s)", "Back to main menu"]
    target_menu = TerminalMenu(options)
    target_entry_index = target_menu.show()

    match options[target_entry_index]:
        case "Add IPs":
            add_ips_to_file()
        case "Open file of IPs":
            open_and_append_file()
        case "Remove target(s)":
            remove_targets()
        case "List targets":
            with open("target_ips.txt", "r") as f:
                targets = f.readlines()
                print("Current targets:")
                for i, target in enumerate(targets):
                    print(f"{i + 1}. {target.strip()}")
        case "Back to main menu":
            starting_menu()
