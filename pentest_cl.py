from simple_term_menu import TerminalMenu
from pyfiglet import Figlet
import target
import backend
import os

exit_program = False 
project_directory_path = None

def main():
    global project_directory_path
    custom_fig = Figlet(font='graffiti')
    print(custom_fig.renderText('Pentest_CL'))
    print("\n\n-----------------------------------------------------------------------------")
    print("Made by Zoogs for you degens - run it as root if you want to run network scans")
    print("-----------------------------------------------------------------------------\n\n")

    project_options = ["Start a new project", "Open existing project"]
    project_menu = TerminalMenu(project_options)
    project_choice = project_menu.show()

    if project_choice == 0:
        create_project_directory()
        if project_directory_path:
            backend.create_database(project_directory_path)
    elif project_choice == 1:
        open_existing_project()
    else:
        print("Invalid choice.")

    starting_menu()

def create_project_directory():
    global project_directory_path
    project_name = input("Enter the name of the new project: ")
    project_directory_path = os.path.join(os.getcwd(), project_name)
    if not os.path.exists(project_directory_path):
        os.makedirs(project_directory_path)
        print(f"New project directory '{project_name}' created successfully.")
    else:
        print(f"Directory '{project_name}' already exists.")

def open_existing_project():
    global project_directory_path
    project_path = input("Enter the path of the existing project directory: ")
    if os.path.exists(project_path) and os.path.isdir(project_path):
        project_directory_path = project_path
        print(f"Opened existing project directory '{os.path.basename(project_path)}'.")
    else:
        print("Invalid project directory path.")

def starting_menu():
    global exit_program
    while not exit_program:
        options = ["Target Options", "entry 2", "Exit"]
        terminal_menu = TerminalMenu(options)
        menu_entry_index = terminal_menu.show()
        #print(f"You have selected {options[menu_entry_index]}!")

        match options[menu_entry_index]:
            case "Target Options":
                target.targets_menu(project_directory_path)
            case "Exit":
                exit_program = True
    
    
if __name__ == "__main__":
    main()
